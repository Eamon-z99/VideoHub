# VideoHub ä½¿ç”¨æŒ‡å—

> ä¸¤å¥—æ–¹æ¡ˆï¼šPythonæ‰¹é‡è½¬ç ï¼ˆæµ‹è¯•ï¼‰+ Spring Bootä¸Šä¼ è½¬ç ï¼ˆç”Ÿäº§ï¼‰

---

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

### æ–¹æ¡ˆä¸€ï¼šPythonæ‰¹é‡è½¬ç ï¼ˆæµ‹è¯•ç”¨ï¼‰
- **ç”¨é€”**ï¼šä¸€æ¬¡æ€§å¤„ç†1000ä¸ªMP4è§†é¢‘
- **è„šæœ¬**ï¼š`scripts/batch_transcode.py`
- **è¾“å‡º**ï¼š`E:\VideoHubStorage\videos\{video_id}\`

### æ–¹æ¡ˆäºŒï¼šSpring Bootä¸Šä¼ è½¬ç ï¼ˆç”Ÿäº§ç”¨ï¼‰
- **ç”¨é€”**ï¼šç”¨æˆ·é€šè¿‡å‰ç«¯ä¸Šä¼ è§†é¢‘ï¼Œåç«¯è‡ªåŠ¨è½¬ç 
- **æ¥å£**ï¼š`POST /api/upload`
- **è¾“å‡º**ï¼šç›¸åŒçš„å­˜å‚¨ç»“æ„

**ä¸¤å¥—æ–¹æ¡ˆä½¿ç”¨å®Œå…¨ç›¸åŒçš„å­˜å‚¨ç»“æ„ï¼Œç¡®ä¿å…¼å®¹ï¼**

---

## ğŸš€ æ–¹æ¡ˆä¸€ï¼šPythonæ‰¹é‡è½¬ç ï¼ˆç«‹å³å¼€å§‹ï¼‰

### Step 1ï¼šå‡†å¤‡ç¯å¢ƒ

1. **å®‰è£…FFmpeg**
   - ä¸‹è½½ï¼šhttps://ffmpeg.org/download.html
   - è§£å‹åæ·»åŠ åˆ°PATHï¼Œæˆ–è®°å½•å®Œæ•´è·¯å¾„

2. **åˆ›å»ºå­˜å‚¨ç›®å½•**
   ```
   E:\VideoHubStorage\
     â”œâ”€ videos\          # è½¬ç åçš„è§†é¢‘ï¼ˆPythonè„šæœ¬è¾“å‡ºï¼‰
     â”œâ”€ source\          # åŸå§‹MP4å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
     â””â”€ temp\            # ä¸´æ—¶æ–‡ä»¶
   ```

3. **å‡†å¤‡Pythonç¯å¢ƒ**
   ```bash
   python --version  # ç¡®ä¿Python 3.7+
   ```

### Step 2ï¼šé…ç½®è„šæœ¬

æ‰“å¼€ `scripts/batch_transcode.py`ï¼Œä¿®æ”¹é…ç½®ï¼š

```python
# ç¬¬12-13è¡Œ
SOURCE_DIR = r"E:\YourMp4Videos"  # âš ï¸ æ”¹æˆä½ çš„1000ä¸ªMP4ç›®å½•
OUTPUT_ROOT = r"E:\VideoHubStorage\videos"  # è¾“å‡ºç›®å½•

# ç¬¬16-17è¡Œï¼ˆå¦‚æœFFmpegä¸åœ¨PATHä¸­ï¼‰
FFMPEG_PATH = r"C:\ffmpeg\bin\ffmpeg.exe"  # å®Œæ•´è·¯å¾„
FFPROBE_PATH = r"C:\ffmpeg\bin\ffprobe.exe"
```

### Step 3ï¼šæµ‹è¯•å•ä¸ªè§†é¢‘

1. **ä¸´æ—¶ä¿®æ”¹è„šæœ¬**ï¼ˆç¬¬280è¡Œå·¦å³ï¼‰ï¼š
   ```python
   mp4_files = [mp4_files[0]]  # åªå¤„ç†ç¬¬ä¸€ä¸ª
   ```

2. **è¿è¡Œè„šæœ¬**ï¼š
   ```bash
   cd D:\vue_project\VideoHub
   python scripts/batch_transcode.py
   ```

3. **éªŒè¯è¾“å‡º**ï¼š
   ```
   E:\VideoHubStorage\videos\video_0001\
     â”œâ”€ manifest.json
     â”œâ”€ videoInfo.json
     â”œâ”€ video_1080p\
     â”‚   â”œâ”€ init.m4s
     â”‚   â”œâ”€ seg-001.m4s
     â”‚   â””â”€ ...
     â”œâ”€ video_720p\
     â”œâ”€ video_480p\
     â””â”€ audio_128k\
   ```

### Step 4ï¼šå…¨é‡è½¬ç 

1. **æ¢å¤è„šæœ¬**ï¼ˆåˆ é™¤æµ‹è¯•é™åˆ¶ï¼‰

2. **è¿è¡Œæ‰¹é‡è½¬ç **ï¼š
   ```bash
   python scripts/batch_transcode.py
   ```

3. **é¢„è®¡æ—¶é—´**ï¼š
   - æ¯ä¸ªè§†é¢‘çº¦5-10åˆ†é’Ÿ
   - 1000ä¸ªè§†é¢‘éœ€è¦å‡ å¤©æ—¶é—´
   - å»ºè®®åˆ†æ‰¹å¤„ç†æˆ–åå°è¿è¡Œ

---

## ğŸ¯ æ–¹æ¡ˆäºŒï¼šSpring Bootä¸Šä¼ è½¬ç ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### Step 1ï¼šé…ç½®åç«¯

1. **æ£€æŸ¥ `application.properties`**
   ```properties
   video.storage.root=E:\\VideoHubStorage
   video.storage.videos=${video.storage.root}\\videos
   video.storage.source=${video.storage.root}\\source
   video.storage.temp=${video.storage.root}\\temp
   
   ffmpeg.path=ffmpeg  # å¦‚æœåœ¨PATHä¸­ï¼Œå¦åˆ™ç”¨å®Œæ•´è·¯å¾„
   ffprobe.path=ffprobe
   ```

2. **ç¡®ä¿FFmpegå¯ç”¨**
   - åç«¯å¯åŠ¨æ—¶ä¼šè°ƒç”¨FFmpeg
   - ç¡®ä¿FFmpegåœ¨PATHä¸­ï¼Œæˆ–ä¿®æ”¹é…ç½®ä½¿ç”¨å®Œæ•´è·¯å¾„

### Step 2ï¼šå¯åŠ¨åç«¯

```bash
cd D:\vue_project\VideoHub\backend\VideoBackend
mvn spring-boot:run
```

### Step 3ï¼šæµ‹è¯•ä¸Šä¼ æ¥å£

**ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•ï¼š**

```bash
curl -X POST http://localhost:8081/api/upload \
  -F "file=@your_video.mp4" \
  -F "title=æµ‹è¯•è§†é¢‘"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "videoId": "video_abc12345",
  "message": "ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨è½¬ç ä¸­...",
  "status": "PROCESSING",
  "progress": 0
}
```

### Step 4ï¼šæŸ¥è¯¢è½¬ç çŠ¶æ€

```bash
curl http://localhost:8081/api/video/video_abc12345/status
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "videoId": "video_abc12345",
  "status": "DONE",
  "progress": 100,
  "message": "è½¬ç å®Œæˆ"
}
```

### Step 5ï¼šå‰ç«¯é›†æˆ

**ä¸Šä¼ ç»„ä»¶ç¤ºä¾‹ï¼š**

```vue
<template>
  <el-upload
    :action="uploadUrl"
    :on-success="handleSuccess"
    :before-upload="beforeUpload"
  >
    <el-button>ä¸Šä¼ è§†é¢‘</el-button>
  </el-upload>
</template>

<script setup>
import { ref } from 'vue'
import request from '@/utils/request'

const uploadUrl = '/api/upload'

const handleSuccess = (response) => {
  console.log('ä¸Šä¼ æˆåŠŸ:', response.videoId)
  // è½®è¯¢æŸ¥è¯¢è½¬ç çŠ¶æ€
  checkStatus(response.videoId)
}

const checkStatus = async (videoId) => {
  const { data } = await request.get(`/video/${videoId}/status`)
  if (data.status === 'DONE') {
    // è½¬ç å®Œæˆï¼Œè·³è½¬åˆ°æ’­æ”¾é¡µ
    router.push(`/video/${videoId}`)
  } else {
    // ç»§ç»­è½®è¯¢
    setTimeout(() => checkStatus(videoId), 3000)
  }
}
</script>
```

---

## ğŸ“Š å­˜å‚¨ç»“æ„ï¼ˆä¸¤å¥—æ–¹æ¡ˆå…±ç”¨ï¼‰

```
E:\VideoHubStorage\
â”œâ”€ videos\                    # æ‰€æœ‰è½¬ç åçš„è§†é¢‘
â”‚  â”œâ”€ video_0001\            # Pythonè„šæœ¬ç”Ÿæˆ
â”‚  â”‚  â”œâ”€ manifest.json
â”‚  â”‚  â”œâ”€ videoInfo.json
â”‚  â”‚  â”œâ”€ video_1080p\
â”‚  â”‚  â”œâ”€ video_720p\
â”‚  â”‚  â”œâ”€ video_480p\
â”‚  â”‚  â””â”€ audio_128k\
â”‚  â”œâ”€ video_abc12345\        # Spring Bootä¸Šä¼ ç”Ÿæˆ
â”‚  â”‚  â””â”€ ...ï¼ˆç›¸åŒç»“æ„ï¼‰
â”‚  â””â”€ ...
â”œâ”€ source\                   # åŸå§‹MP4å¤‡ä»½
â”‚  â”œâ”€ video_0001.mp4
â”‚  â””â”€ ...
â””â”€ temp\                     # ä¸´æ—¶æ–‡ä»¶
```

---

## ğŸ” APIæ¥å£è¯´æ˜

### 1. ä¸Šä¼ è§†é¢‘
```
POST /api/upload
Content-Type: multipart/form-data

å‚æ•°ï¼š
- file: è§†é¢‘æ–‡ä»¶ï¼ˆMP4ï¼‰
- title: è§†é¢‘æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰

å“åº”ï¼š
{
  "videoId": "video_xxx",
  "status": "PROCESSING",
  "progress": 0
}
```

### 2. æŸ¥è¯¢è½¬ç çŠ¶æ€
```
GET /api/video/{videoId}/status

å“åº”ï¼š
{
  "videoId": "video_xxx",
  "status": "DONE|PROCESSING|FAILED",
  "progress": 100
}
```

### 3. è·å–æ’­æ”¾æ¸…å•
```
GET /api/playurl/{cid}

å“åº”ï¼š
{
  "cid": "video_xxx",
  "duration": 300,
  "dash": {
    "video": [...],
    "audio": [...]
  }
}
```

### 4. è§†é¢‘åˆ—è¡¨
```
GET /api/videos

å“åº”ï¼š
[
  {
    "id": "video_xxx",
    "title": "è§†é¢‘æ ‡é¢˜",
    "duration": 300,
    ...
  }
]
```

---

## âœ… éªŒè¯æ­¥éª¤

### 1. Pythonè„šæœ¬è½¬ç åéªŒè¯

```bash
# æ£€æŸ¥manifest.jsonæ˜¯å¦å­˜åœ¨
dir E:\VideoHubStorage\videos\video_0001\manifest.json

# æ£€æŸ¥åˆ†ç‰‡æ–‡ä»¶
dir E:\VideoHubStorage\videos\video_0001\video_1080p\*.m4s
```

### 2. åç«¯æ¥å£éªŒè¯

```bash
# æµ‹è¯•playurlæ¥å£
curl http://localhost:8081/playurl/video_0001

# æµ‹è¯•è§†é¢‘åˆ—è¡¨
curl http://localhost:8081/api/videos
```

### 3. å‰ç«¯æ’­æ”¾éªŒè¯

1. è®¿é—®ï¼š`http://localhost:5173/video/video_0001`
2. åº”è¯¥èƒ½æ­£å¸¸æ’­æ”¾

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. FFmpegæœªæ‰¾åˆ°

**é”™è¯¯**ï¼š`java.io.IOException: Cannot run program "ffmpeg"`

**è§£å†³**ï¼š
- ç¡®ä¿FFmpegåœ¨PATHä¸­
- æˆ–ä¿®æ”¹ `application.properties`ï¼š
  ```properties
  ffmpeg.path=C:\\ffmpeg\\bin\\ffmpeg.exe
  ffprobe.path=C:\\ffmpeg\\bin\\ffprobe.exe
  ```

### 2. è½¬ç å¤±è´¥

**æ£€æŸ¥**ï¼š
- FFmpegç‰ˆæœ¬æ˜¯å¦æ”¯æŒDASHæ ¼å¼
- æºè§†é¢‘æ ¼å¼æ˜¯å¦æ”¯æŒ
- ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³

### 3. é™æ€èµ„æº404

**æ£€æŸ¥**ï¼š
- `application.properties` ä¸­çš„è·¯å¾„æ˜¯å¦æ­£ç¡®
- Windowsè·¯å¾„åˆ†éš”ç¬¦æ˜¯å¦æ­£ç¡®ï¼ˆ`\\`ï¼‰

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… **Pythonæ‰¹é‡è½¬ç **ï¼šå¤„ç†1000ä¸ªæµ‹è¯•è§†é¢‘
2. âœ… **åç«¯ä¸Šä¼ æ¥å£**ï¼šæ”¯æŒç”¨æˆ·ä¸Šä¼ 
3. ğŸ”„ **å‰ç«¯ä¸Šä¼ é¡µé¢**ï¼šæ·»åŠ ä¸Šä¼ UI
4. ğŸ”„ **æ’­æ”¾é¡µå¤šæ¸…æ™°åº¦**ï¼šæ”¯æŒæ¸…æ™°åº¦åˆ‡æ¢
5. ğŸ”„ **è§†é¢‘åˆ—è¡¨é¡µ**ï¼šå±•ç¤ºæ‰€æœ‰è§†é¢‘

---

## ğŸ’¡ æç¤º

- **ä¸¤å¥—æ–¹æ¡ˆå®Œå…¨å…¼å®¹**ï¼šPythonè½¬ç çš„è§†é¢‘å’ŒSpring Bootä¸Šä¼ çš„è§†é¢‘ä½¿ç”¨ç›¸åŒç»“æ„
- **å¯ä»¥æ··åˆä½¿ç”¨**ï¼šå…ˆç”¨Pythonæ‰¹é‡è½¬ç ï¼Œåç»­ç”¨Spring Bootå¤„ç†æ–°ä¸Šä¼ 
- **å­˜å‚¨ç»Ÿä¸€**ï¼šæ‰€æœ‰è§†é¢‘éƒ½åœ¨ `E:\VideoHubStorage\videos\` ä¸‹







