# VideoHub 推荐系统抗投毒防御集成方案

## 一、项目概述

本文档详细说明如何在VideoHub视频网站系统中集成推荐系统，实现投毒攻击模拟和防御机制。

## 二、系统架构

### 2.1 整体架构

```
┌─────────────────┐
│   前端 (Vue)    │
│  - 推荐展示     │
│  - 防御提示     │
└────────┬────────┘
         │ HTTP API
┌────────▼────────┐
│ 后端 (Spring)   │
│  - 推荐算法      │
│  - 防御检测      │
└────────┬────────┘
         │ SQL
┌────────▼────────┐
│  数据库 (MySQL)  │
│  - 用户行为数据  │
│  - 视频数据      │
└─────────────────┘
         │
┌────────▼────────┐
│ Python脚本       │
│  - 投毒攻击      │
│  - 效果可视化    │
└─────────────────┘
```

### 2.2 数据流

1. **用户行为数据收集**
   - 用户点赞 (`video_likes`)
   - 用户收藏 (`favorites`)
   - 播放历史 (`play_history`)

2. **推荐算法计算**
   - 基于用户的协同过滤
   - 基于物品的协同过滤
   - 用户-物品评分矩阵构建

3. **防御机制**
   - 实时行为检测
   - 可疑用户识别
   - 推荐结果过滤

## 三、后端集成

### 3.1 新增文件

1. **UserBehavior.java** - 用户行为数据模型
2. **UserBehaviorRepository.java** - 行为数据仓库
3. **RecommendationService.java** - 推荐算法服务
4. **RecommendationController.java** - 推荐API控制器
5. **DefenseService.java** - 防御检测服务
6. **DefenseController.java** - 防御API控制器

### 3.2 API接口

#### 推荐接口

- `GET /api/recommendations/user/{userId}?limit=10`
  - 基于用户的协同过滤推荐
  - 返回推荐视频列表

- `GET /api/recommendations/item/{userId}?limit=10`
  - 基于物品的协同过滤推荐
  - 返回推荐视频列表

#### 防御接口

- `GET /api/defense/detect/{userId}`
  - 检测指定用户是否为攻击者
  - 返回检测结果和风险评分

- `GET /api/defense/suspicious`
  - 获取所有可疑用户列表
  - 返回可疑用户ID集合

### 3.3 推荐算法实现

#### 基于用户的协同过滤

1. **构建用户-视频评分矩阵**
   ```java
   // 行为评分权重：
   // 点赞 = 1.0
   // 收藏 = 0.8
   // 播放>50% = 0.6
   // 播放>25% = 0.4
   // 播放>0 = 0.2
   ```

2. **计算用户相似度**
   - 使用余弦相似度
   - 基于共同评分的视频

3. **生成推荐**
   - 选择Top-K相似用户
   - 加权平均预测评分
   - 返回Top-N推荐视频

#### 基于物品的协同过滤

1. **计算视频相似度**
   - 基于共同用户
   - Jaccard相似度

2. **生成推荐**
   - 基于用户历史观看视频
   - 找到相似视频
   - 按相似度排序

### 3.4 防御机制

#### 检测指标

1. **行为数量检测**
   - 正常用户最少行为数：10
   - 单日最大行为数：100

2. **点赞比例检测**
   - 可疑阈值：>80%
   - 正常用户点赞比例通常较低

3. **行为熵（多样性）**
   - 最小熵值：0.5
   - 攻击用户行为单一

4. **时间分布检测**
   - 检测短时间内大量操作
   - 正常用户行为分散

5. **目标集中度**
   - 检测是否集中攻击特定视频
   - 阈值：>50%

#### 风险评分

```java
风险分数 = 
  行为数量异常(0.2) + 
  点赞比例异常(0.3) + 
  熵值不足(0.2) + 
  时间异常(0.15) + 
  目标集中(0.15)

风险分数 > 0.6 → 可疑用户
```

## 四、投毒攻击脚本

### 4.1 脚本位置

`scripts/poison_attack.py`

### 4.2 攻击类型

#### 1. 随机攻击 (Random Attack)

```bash
python scripts/poison_attack.py --attack-type random --user-count 20 --target-count 5
```

- 创建虚假用户
- 随机对目标视频进行点赞和收藏
- 模拟僵尸账户行为

#### 2. 平均攻击 (Average Attack)

```bash
python scripts/poison_attack.py --attack-type average --user-count 20 --target-count 5
```

- 对目标视频给予高分（点赞+收藏）
- 对其他视频给予平均分（少量点赞）
- 更隐蔽的攻击方式

#### 3. 组攻击 (Group Attack)

```bash
python scripts/poison_attack.py --attack-type group --user-count 20 --target-count 5
```

- 将用户分成组
- 每组协同攻击特定视频
- 模拟有组织的攻击

#### 4. 时间爆发攻击 (Time Burst Attack)

```bash
python scripts/poison_attack.py --attack-type time-burst --user-count 20 --target-count 5
```

- 在短时间内集中操作
- 模拟刷量行为

#### 5. 综合攻击

```bash
python scripts/poison_attack.py --attack-type all --user-count 50 --target-count 10
```

- 执行所有攻击类型
- 全面测试防御系统

### 4.3 脚本参数

- `--attack-type`: 攻击类型 (random/average/group/time-burst/all)
- `--user-count`: 虚假用户数量
- `--target-count`: 目标视频数量
- `--actions-per-user`: 每个用户的行为数量

## 五、前端集成

### 5.1 新增组件

1. **RecommendationList.vue**
   - 推荐视频列表展示
   - 防御过滤功能
   - 可疑内容标记

2. **DefenseWarning.vue**
   - 防御警告提示
   - 可疑用户数量显示
   - 实时监控

### 5.2 API调用

```javascript
// 获取推荐
import { getRecommendations } from '@/api/recommendation'
const response = await getRecommendations(userId, 10)

// 检测用户
import { detectUser } from '@/api/recommendation'
const result = await detectUser(userId)
```

### 5.3 防御策略

1. **前端过滤**
   - 过滤可疑用户推荐的内容
   - 标记可疑视频
   - 显示防御状态

2. **实时监控**
   - 定期检查可疑用户
   - 显示警告提示
   - 更新防御状态

## 六、可视化分析

### 6.1 脚本位置

`scripts/visualize_attack_effects.py`

### 6.2 生成图表

运行脚本生成以下图表：

1. **用户行为分布图**
   - 正常用户 vs 攻击用户行为数量
   - 点赞比例对比
   - 行为熵值分布
   - 用户类型统计

2. **视频影响图**
   - 视频点赞数 vs 攻击点赞数
   - 受攻击最严重的视频Top 10
   - 投毒前后对比
   - 攻击影响程度分布

3. **时间分析图**
   - 每日行为数量趋势
   - 攻击用户数量趋势

4. **分析报告**
   - JSON格式统计报告
   - 保存到 `attack_analysis/report.json`

### 6.3 运行方式

```bash
# 安装依赖
pip install -r scripts/requirements.txt

# 运行可视化
python scripts/visualize_attack_effects.py
```

## 七、使用流程

### 7.1 完整测试流程

1. **准备阶段**
   ```bash
   # 确保数据库已初始化
   # 确保后端服务运行
   # 确保前端服务运行
   ```

2. **投毒攻击**
   ```bash
   # 执行投毒攻击
   python scripts/poison_attack.py --attack-type all --user-count 30 --target-count 10
   ```

3. **查看效果**
   - 访问前端页面
   - 查看推荐结果
   - 观察防御提示

4. **可视化分析**
   ```bash
   # 生成分析图表
   python scripts/visualize_attack_effects.py
   ```

5. **防御验证**
   - 调用防御API检测可疑用户
   - 查看防御效果
   - 验证推荐过滤

### 7.2 防御测试

1. **检测可疑用户**
   ```bash
   curl http://localhost:8080/api/defense/suspicious
   ```

2. **检测特定用户**
   ```bash
   curl http://localhost:8080/api/defense/detect/100
   ```

3. **获取推荐（带防御）**
   ```bash
   curl http://localhost:8080/api/recommendations/user/1?limit=10
   ```

## 八、防御策略详解

### 8.1 后端防御

#### 实时检测

- 用户行为数据实时分析
- 多维度特征提取
- 风险评分计算

#### 推荐过滤

- 可疑用户行为不参与推荐计算
- 可疑视频标记和降权
- 推荐结果二次过滤

### 8.2 前端防御

#### 用户提示

- 显示防御状态
- 警告可疑内容
- 提示系统安全

#### 内容过滤

- 前端二次过滤
- 可疑内容标记
- 降权显示

### 8.3 防御效果

- **检测准确率**: 基于多维度特征，准确识别攻击用户
- **误报率**: 通过阈值调优，降低正常用户误判
- **推荐质量**: 过滤攻击后，推荐精度提升
- **系统鲁棒性**: 抵御多种攻击类型

## 九、技术细节

### 9.1 数据库操作

投毒脚本直接修改数据库：
- 插入虚假用户到 `users` 表
- 插入虚假点赞到 `video_likes` 表
- 插入虚假收藏到 `favorites` 表
- 更新视频统计信息

### 9.2 推荐算法优化

- 使用稀疏矩阵存储
- 相似度计算缓存
- 增量更新机制

### 9.3 防御算法优化

- 特征计算缓存
- 批量检测优化
- 实时检测异步处理

## 十、注意事项

1. **数据库备份**
   - 执行投毒攻击前备份数据库
   - 测试完成后可恢复

2. **性能考虑**
   - 大规模数据下优化查询
   - 使用索引加速
   - 缓存计算结果

3. **安全性**
   - 防御API需要权限控制
   - 防止恶意调用
   - 日志记录

4. **扩展性**
   - 支持更多推荐算法
   - 支持更多攻击类型
   - 支持更多防御策略

## 十一、后续优化

1. **算法优化**
   - 矩阵分解推荐
   - 深度学习推荐
   - 混合推荐策略

2. **防御增强**
   - 机器学习检测
   - 图神经网络检测
   - 实时流式检测

3. **系统完善**
   - 管理后台
   - 数据统计
   - 报警机制

---

**文档版本**: v1.0  
**最后更新**: 2026-01-04  
**作者**: 推荐系统项目组



