# 推荐系统快速开始指南

## 一、环境准备

### 1.1 后端环境

确保已安装：
- Java 17+
- Maven
- MySQL 8.0+

### 1.2 前端环境

确保已安装：
- Node.js 16+
- npm 或 yarn

### 1.3 Python环境

确保已安装：
- Python 3.8+
- pip

安装Python依赖：
```bash
cd scripts
pip install -r requirements.txt
```

## 二、数据库配置

### 2.1 修改数据库连接

编辑 `backend/VideoBackend/src/main/resources/application.properties`:

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/videohub?...
spring.datasource.username=root
spring.datasource.password=你的密码
```

### 2.2 修改Python脚本配置

编辑 `scripts/poison_attack.py` 和 `scripts/visualize_attack_effects.py`:

```python
DB_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': '你的密码',
    'database': 'videohub',
    'charset': 'utf8mb4'
}
```

## 三、启动服务

### 3.1 启动后端

```bash
cd backend/VideoBackend
mvn spring-boot:run
```

后端将在 `http://localhost:8080` 启动

### 3.2 启动前端

```bash
cd frontend/VideoHub_web
npm install  # 首次运行
npm run dev
```

前端将在 `http://localhost:5173` 启动（或Vite配置的端口）

## 四、测试推荐系统

### 4.1 测试推荐API

```bash
# 获取用户推荐（用户ID=1）
curl http://localhost:8080/api/recommendations/user/1?limit=10

# 基于物品的推荐
curl http://localhost:8080/api/recommendations/item/1?limit=10
```

### 4.2 测试防御API

```bash
# 检测用户是否为攻击者
curl http://localhost:8080/api/defense/detect/1

# 获取可疑用户列表
curl http://localhost:8080/api/defense/suspicious
```

## 五、执行投毒攻击

### 5.1 备份数据库（重要！）

```bash
mysqldump -u root -p videohub > videohub_backup.sql
```

### 5.2 执行攻击

```bash
cd scripts

# 随机攻击（20个虚假用户，5个目标视频）
python poison_attack.py --attack-type random --user-count 20 --target-count 5

# 平均攻击
python poison_attack.py --attack-type average --user-count 20 --target-count 5

# 组攻击
python poison_attack.py --attack-type group --user-count 20 --target-count 5

# 综合攻击（所有类型）
python poison_attack.py --attack-type all --user-count 30 --target-count 10
```

### 5.3 查看攻击效果

攻击后，可以：
1. 查看数据库中的虚假用户和虚假行为
2. 调用推荐API，观察推荐结果变化
3. 调用防御API，检测可疑用户

## 六、可视化分析

### 6.1 生成分析图表

```bash
cd scripts
python visualize_attack_effects.py
```

### 6.2 查看结果

图表将保存在 `scripts/attack_analysis/` 目录：
- `user_behavior_distribution.png` - 用户行为分布
- `video_impact.png` - 视频影响分析
- `time_analysis.png` - 时间分析
- `report.json` - 统计报告

## 七、前端集成

### 7.1 使用推荐组件

在Vue组件中使用：

```vue
<template>
  <RecommendationList 
    :algorithm="'user-based'"
    :enable-defense="true"
  />
  <DefenseWarning />
</template>

<script>
import RecommendationList from '@/components/RecommendationList.vue'
import DefenseWarning from '@/components/DefenseWarning.vue'

export default {
  components: {
    RecommendationList,
    DefenseWarning
  }
}
</script>
```

### 7.2 在路由中使用

编辑 `frontend/VideoHub_web/src/router/index.js`:

```javascript
{
  path: '/recommendations',
  name: 'Recommendations',
  component: () => import('@/components/RecommendationList.vue')
}
```

## 八、防御策略说明

### 8.1 后端防御

防御系统会自动：
1. 检测用户行为异常
2. 计算风险评分
3. 标记可疑用户
4. 过滤推荐结果

### 8.2 前端防御

前端会：
1. 显示防御状态
2. 过滤可疑内容
3. 警告用户异常情况

### 8.3 防御指标

- **行为数量**: 正常用户最少10个行为
- **点赞比例**: 超过80%视为可疑
- **行为熵**: 低于0.5视为可疑
- **时间分布**: 短时间内大量操作视为可疑
- **目标集中度**: 超过50%视为可疑

## 九、常见问题

### Q1: 推荐API返回空列表？

**A**: 检查：
1. 数据库中是否有用户行为数据
2. 用户ID是否正确
3. 后端日志是否有错误

### Q2: 防御检测不准确？

**A**: 可以调整 `DefenseService.java` 中的阈值：
```java
private static final double SUSPICIOUS_LIKE_RATIO = 0.8;
private static final int MIN_NORMAL_ACTIONS = 10;
// ...
```

### Q3: Python脚本连接数据库失败？

**A**: 检查：
1. MySQL服务是否运行
2. 数据库配置是否正确
3. 是否有数据库访问权限

### Q4: 可视化图表中文乱码？

**A**: 确保系统安装了中文字体，或修改 `visualize_attack_effects.py`:
```python
matplotlib.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']
```

## 十、恢复数据库

如果需要恢复数据库：

```bash
mysql -u root -p videohub < videohub_backup.sql
```

或者手动删除虚假用户：

```sql
DELETE FROM video_likes WHERE user_id IN (
    SELECT id FROM users WHERE account LIKE 'attack_user_%'
);
DELETE FROM favorites WHERE user_id IN (
    SELECT id FROM users WHERE account LIKE 'attack_user_%'
);
DELETE FROM users WHERE account LIKE 'attack_user_%';
```

## 十一、下一步

1. **优化推荐算法**
   - 调整相似度计算方法
   - 优化推荐数量
   - 加入时间衰减

2. **增强防御机制**
   - 调整检测阈值
   - 加入机器学习检测
   - 实时流式检测

3. **完善前端界面**
   - 优化推荐展示
   - 增强防御提示
   - 添加统计分析

---

**提示**: 如有问题，请查看 `推荐系统集成方案.md` 获取详细说明。



