## 项目优化说明

本次针对请求层、路由与用户状态做了若干改进，提升了可维护性、错误处理体验与登录态跳转的稳定性。

### 1. 请求模块（axios）
- 位置：`src/utils/request.js`
- 主要优化：
  - 使用环境变量 `VITE_API_BASE_URL` 或默认的`/api`作为 `baseURL`，便于开发使用 Vite 代理、生产环境走真实域名。
  - 增加请求超时：`timeout: 15000`。
  - 统一错误提示：通过 Element Plus 的 `ElMessage` 展示错误信息。
  - 处理 401：自动清空登录态，跳转到 `/login?redirect=当前页`，保持原页面的返回路径。

示例（节选）：
```js
// src/utils/request.js
const BASE_URL = import.meta.env.VITE_API_BASE_URL || '/api'
const instance = axios.create({ baseURL: BASE_URL, timeout: 15000 })
```

环境变量配置：
```bash
# .env.development（示例）
VITE_API_BASE_URL=/api

# .env.production（示例）
VITE_API_BASE_URL=https://api.example.com
```

相关代理（Vite）：
```js
// vite.config.js（节选）
proxy: {
  '/api': {
    target: 'http://localhost:8080',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api/, ''),
  }
}
```

### 2. 路由与守卫
- 位置：`src/router/index.js`
- 主要优化：
  - 新增登录页路由：`/login`（懒加载）。
  - 路由守卫完善：
    - `requiresAuth`: 未登录访问受保护路由时，跳转 `/login?redirect=原地址`。
    - `guestOnly`: 已登录访问仅访客可见页面（如登录页）时，重定向回来源或首页。

示例（节选）：
```js
// 受保护路由
{ path: '/history', component: History, meta: { requiresAuth: true } }

// 仅访客路由
{ path: '/login', component: Login, meta: { guestOnly: true } }
```

### 3. 用户状态仓库（Pinia）
- 位置：`src/stores/user.js`
- 主要优化：
  - 新增 `isAuthenticated` 计算属性，便于全局判断登录态。
  - 新增 `logout` 方法（`clear` 的别名），统一登出入口。

使用示例：
```js
import { useUserStore } from '@/stores/user'
const userStore = useUserStore()

if (userStore.isAuthenticated) {
  // 已登录逻辑
}
```

### 4. 登录组件优化
- 位置：`src/components/Login.vue`
- 主要优化：
  - 支持两种模式：弹窗模式（通过 `v-model:show` 控制）和路由模式（访问 `/login` 路由时自动显示）
  - 登录成功后自动处理跳转：优先跳转到 `route.query.redirect`，否则默认首页
  - 路由模式下关闭时自动跳转到首页或 redirect 页面

### 5. 建议的后续调整
- `components/Login.vue`：
  - 接口路径建议改为 `/auth/login`（配合上文 Vite 代理 `baseURL=/api`），避免在组件中再次写 `/api` 前缀。
  - 登录成功后跳转：优先跳转到 `route.query.redirect`，否则默认首页 `/`。

示例（建议修改方向，节选）：
```js
// components/Login.vue（逻辑示例）
const route = useRoute()
const router = useRouter()
const res = await axios.post('/auth/login', form.value)
// ... 存储 token 与用户信息
router.replace((route.query.redirect && String(route.query.redirect)) || '/')
```

---

如需我继续落实第 5 点对 `components/Login.vue` 的具体修改，请告知。 

