# VideoHub 微前端重构说明

## 项目结构

```
VideoHub/
├── frontend/                    # 前端项目目录
│   ├── main-app/               # 主应用（容器应用）
│   │   ├── src/
│   │   │   ├── main.js       # 主应用入口，注册 qiankun 微应用
│   │   │   ├── App.vue       # 主应用根组件
│   │   │   ├── router/       # 主应用路由
│   │   │   └── views/        # 主应用视图
│   │   ├── package.json
│   │   └── vite.config.js
│   │
│   └── VideoHub_web/          # 子应用（已改造为 qiankun 微应用）
│       ├── src/
│       │   ├── main.js       # 导出 qiankun 生命周期函数
│       │   ├── router/       # 子应用路由（已支持 base 路径）
│       │   └── ...
│       ├── package.json
│       └── vite.config.js    # 已配置 CORS 和子应用支持
│
└── backend/                     # 后端项目目录
    └── VideoBackend/           # Spring Boot 后端服务
```

## 技术栈

- **主应用**: Vue 3 + Vite + qiankun
- **子应用**: Vue 3 + Vite（已改造为 qiankun 子应用）

## 快速开始

### 1. 安装依赖

#### 主应用
```bash
cd frontend/main-app
npm install
```

#### 子应用
```bash
cd frontend/VideoHub_web
npm install
```

### 2. 启动开发环境

#### 方式一：分别启动（推荐）

**终端 1 - 启动子应用：**
```bash
cd frontend/VideoHub_web
npm run dev
```
子应用将在 `http://localhost:5173` 运行

**终端 2 - 启动主应用：**
```bash
cd frontend/main-app
npm run dev
```
主应用将在 `http://localhost:8080` 运行

访问 `http://localhost:8080/videohub` 即可看到完整的微前端应用

#### 方式二：独立运行子应用

子应用也可以独立运行：
```bash
cd VideoHub_web
npm run dev
```
访问 `http://localhost:5173` 即可独立使用

### 3. 构建生产版本

#### 构建子应用
```bash
cd frontend/VideoHub_web
npm run build
```

#### 构建主应用
```bash
cd frontend/main-app
npm run build
```

## 关键配置说明

### 主应用配置（main-app）

1. **注册微应用** (`src/main.js`)
   - 使用 `registerMicroApps` 注册子应用
   - 配置子应用的入口地址、容器、激活规则等

2. **路由配置** (`src/router/index.js`)
   - 主应用路由负责导航和子应用的激活

### 子应用配置（VideoHub_web）

1. **生命周期函数** (`src/main.js`)
   - 导出 `bootstrap`、`mount`、`unmount` 三个生命周期函数
   - 支持独立运行和作为子应用运行

2. **路由配置** (`src/router/index.js`)
   - 自动检测 qiankun 环境，设置正确的 base 路径
   - 在 qiankun 环境下使用 `/videohub` 作为 base

3. **Vite 配置** (`vite.config.js`)
   - 配置 CORS 头，允许主应用加载资源
   - 配置开发服务器支持跨域

## 添加新的子应用

如果需要添加新的子应用，在主应用的 `src/main.js` 中注册：

```javascript
registerMicroApps([
  {
    name: 'videohub-app',
    entry: '//localhost:5173',
    container: '#subapp-container',
    activeRule: '/videohub',
  },
  {
    name: 'new-app',  // 新应用
    entry: '//localhost:5174',
    container: '#subapp-container',
    activeRule: '/new-app',
  }
])
```

## 注意事项

1. **样式隔离**: qiankun 已配置样式隔离，子应用的样式不会影响主应用
2. **路由冲突**: 确保子应用的路由 base 路径与主应用的 activeRule 匹配
3. **API 代理**: 子应用的 API 代理配置在 `vite.config.js` 中，可根据实际情况调整
4. **生产环境**: 生产环境需要将子应用部署到服务器，并更新主应用中的 `entry` 地址

## 常见问题

### 1. 子应用无法加载
- 检查子应用是否正常启动
- 检查主应用中的 `entry` 地址是否正确
- 检查浏览器控制台是否有 CORS 错误

### 2. 路由跳转问题
- 确保子应用的路由 base 配置正确
- 检查主应用的 `activeRule` 是否匹配

### 3. 样式问题
- qiankun 已配置样式隔离，如果仍有问题，可以调整 `strictStyleIsolation` 配置

## 下一步

1. 根据实际需求调整主应用的导航和布局
2. 配置生产环境的部署地址
3. 添加更多子应用（如管理后台、数据分析等）
4. 配置全局状态管理（如果需要主应用和子应用共享状态）

